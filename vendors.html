<body>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vendors</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#009500">
    <style>
        html, body {
            height: 100%;
            margin: 5px;
            font-family: Arial, sans-serif;
            text-align: center;
            -webkit-tap-highlight-color: transparent; 
            user-select: none; 
            -webkit-user-select: none; 
            -moz-user-select: none; 
            -ms-user-select: none;
         }

         .page-wrapper {
              min-height: 100%;
              display: flex;
              flex-direction: column;
         }

         .content {
              flex: 1;
         }
        
        input {
            width: 80%;
            padding: 10px;
            margin: 5px 0;
        }
        input:focus {
            outline: 2px solid #009500;
        }
        .error {
            color: red;
            font-size: 14px;
            margin-top: -5px;
        }
        button, .button {
            padding: 10px;
            background-color: #009500;
            color: white;
            border: none;
            cursor: pointer;
            margin-top: 10px;
            border-radius:20px;
            text-decoration: none;
        }
        #message {
            margin-top: 10px;
            font-weight: bold;
        }
  .footer {
      background: #000;
      color: #fff;
      text-align: center;
      font-size: 10px;      
      bottom:0;
      left: 0;           
      position: fixed;      
      width: 100vw;
  }
  .footer b {
      font-size: 12px;
      color: #009500;
      margin-top: 10px;
  }
  #successPopup {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

#popupBox {
    background: #fff;
    padding: 20px;
    border-radius: 8px;
    text-align: center;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
    width: 300px;
}

#popupMessage {
    margin-bottom: 15px;
}

#okButton {
    margin-top: 15px;
    padding: 8px 16px;
    background: #009500;
    color: #fff;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}
.contact {
  background: #fff;
  font-family: 'Righteous', cursive;
}

.contact-inner {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: calc(100% - 20px);
  margin: 0 auto;
  padding: 50px 10px;
  margin-bottom: 20px;
}

.contact-logo {
  width: 100px;
  height: auto;
  margin-top: -1px;
}

.contact-link {
  color: #009500;
  text-decoration: none;
  font-weight: bold;
}

.contact-link i {
  font-size: 20px;
}

label {
  padding: 20px;
  display: block;
}

#termsCheckbox {
  transform: scale(1.5);
  vertical-align: middle;
  margin-right: 8px;
}

#termsCheckbox:focus {
  outline: none;
  box-shadow: none;
}

#termsModal {

  position: fixed;
  top: 50px;
  left: 50px;
  right: 50px;
  bottom: 50px;
  background-color: white;
  border: 1px solid #ccc;
  z-index: 9999;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
  display: flex;
  display: none;  
  flex-direction: column;
}

#termsIframe {
  flex: 1;
  border: none;
  width: 100%;
  height: 100%;
}

#termsFooter {
  padding: 10px;
  text-align: right;
  border-top: 1px solid #ccc;
}

#termsFooter button {
  padding: 10px 18px;
  margin-left: 10px;
  font-size: 14px;
  border: none;
  cursor: pointer;
  border-radius: 4px;
}

#termsAcceptBtn {
  background-color: #009500;
  color: white;
}

#termsRejectBtn {
  background-color: grey;
  color: white;
}

#termsOverlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  background: rgba(0, 0, 0, 0.5);
  z-index: 9998;
}

@media (max-width: 600px) {
  #termsModal {
    top: 30px;
    left: 20px;
    right: 20px;
    bottom: 30px;
  }

  #termsFooter {
    text-align: center;
  }

  #termsFooter button {
    width: 45%;
    margin: 5px;
  }
}
    </style>


<div class="page-wrapper">
  <div class="content">
<!-- xxxxxxxxxxxxxxxxxx -->
    <header style="position: fixed; top: 0; left: 0; width: 100vw; height: 50px;background-color: #000; display: flex; justify-content: center; align-items: center;z-index: 1000;">
  <a href="https:nearbys.online" style="display: inline-block; text-decoration: none;">
    <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/nearbys-logo.webp?v=1741164503" alt="Order App Logo" style="width: 150px; height: auto; display: block;">
  </a>
</header>
<!-- xxxxxxxxxxxxxxxxxx -->    
    
    <div id="loginContainer" style="margin-top:100px;"> 
        
        <h1 style="margin-bottom:50px;">Vendors</h1>           
        
        <input type="text" id="userId" placeholder="User ID" required>
        <div id="userIdError" class="error"></div>
        
        <input type="text" id="vendorsCode" placeholder="Vendor-Code" required>
        <div id="vendorsCodeError" class="error"></div>
        
        <button id="loginBtn" style="font-weight:bold; font-size:18px; padding:10px 50px; margin-top:20px; margin-bottom:50px;">Login</button><br>
                        
       <div style="display:flex;">
       <p style="position:absolute; left: 10%;">not yet registered ?</p>
        <button id="addShopBtn" style="border-radius:5px; padding:10px 10px; position:absolute; right:10%;">Add your Store</button>
        </div>                
<button id="installBtn" style="position: fixed; bottom: 10px; left: 10px; z-index: 9999; padding: 10px 20px; background-color: #009500; color: white; border: none; border-radius: 8px;">
  📲 Install App
</button>
        
    </div> 

<!-- xxxxxxxxxxxxxxxxxxx -->

    <form id="vendorForm" style="margin-top:60px; display:none;">
        
        <button id="closeVendorForm" style="position:absolute; top:50px; right:10px; background:#555; color:white; border:none; padding:6px 10px; cursor:pointer;">✖
</button>
        
        <h1 style="font-size:20px; text-align:left; padding:20px;">Submit Your Details</h1>

        <input type="text" id="firstName" placeholder="First Name">
        <div class="error" id="firstNameError"></div>

        <input type="text" id="lastName" placeholder="Last Name">
        <div class="error" id="lastNameError"></div>

        <div style="display: flex; flex-direction: column; gap: 5px; align-items: center;">
            <div style="display: flex; align-items: center; width:80%;">
                <input type="text" id="refCode" placeholder="REFF-Code click to validate">
                <button type="button" id="validate" style="margin-top:0px; padding: 12px 15px; border-radius:2px;">Validate</button>
            </div>
            <div class="error" id="refCodeError"></div>
            <div id="reffCodeMsg"></div>
        </div>                      

        <input type="text" id="storeName" placeholder="Store Name">
        <div class="error" id="storeNameError"></div>

        <input type="text" id="storeCategory" placeholder="Store Category">
        <div class="error" id="storeCategoryError"></div>

        <input type="text" id="storesAddress " placeholder="Store Address">
        <div class="error" id="storesAddress Error"></div>  
        
        <div style="display: flex; flex-direction: column; gap: 5px; align-items: center;">
            <div style="display: flex; align-items: center; width:80%;">
                <input type="text" id="location" placeholder="Click 'Get' to retrieve location" disabled>
                <button type="button" id="getLocationButton" style="margin-top:0px; padding: 12px 20px; border-radius:2px;">Get</button>
            </div>
        </div>
        <div class="error" id="locationError"></div>

        <input type="email" id="email" placeholder="Email">
        <div class="error" id="emailError"></div>

        <input type="number" id="contact" placeholder="Contact Number">
        <div class="error" id="contactError"></div>
        <input type="text" id="vendorCode" placeholder="Vendor's Code" style="display:none;">
        <div class="error" id="vendorCodeError"></div>

        <button type="button" onclick="submitUser()" style="font-weight:bold; font-size:18px; padding:10px 115px; margin-top:20px;">Submit</button>
<div id="submittingText" style="display: none; color: blue; margin-top: 10px;">Submitting...</div>
<div style="margin-bottom:20px;" id="message"></div> 
<div class="error" id="termsError"></div>

<!-- -----     t&c     ----- -->     
<label>
  <input type="checkbox" id="termsCheckbox">
 <div>I agree to the <a href="#" id="viewTerms">Terms &amp; Conditions</a>
</div>
</label>

<div id="termsOverlay"></div>
<div id="termsModal">
  <iframe id="termsIframe" src="https://nearbysx.page"></iframe>
  <div id="termsFooter">
    <button id="termsRejectBtn">Reject</button>
    <button id="termsAcceptBtn">Accept</button>
  </div>
</div>
<!-- xxxxxxxxxxxxxxxxxxxx -->              
        
<script> document.getElementById("closeVendorForm").addEventListener("click", function() {
    document.getElementById("vendorForm").style.display = "none";
    document.getElementById("loginContainer").style.display = "block";
});
</script>

    </form>
<!-- xxxxxxxxxxxxxxxxxxx -->
    <div id="vendorDashboard" style="display:none; margin-bottom:100px;">
    <button id="logoutBtn" style="position: absolute; top: 60px; right: 20px; border-radius:5px;">Logout</button>    
    <p>Hello <span style="font-weight:bold;" id="dashboard-firstName">...</span>, following is your Store Information and Payment details </p>
    
    <div style="padding:20px; text-align:left; margin:25px; padding:10px 10px; outline: 1px solid #000; border-radius:10px;">
        <p><b>Store Name: </b><span id="dashboard-storeName">Loading...</span></p> 
        <p><b>Address: </b><span id="dashboard-storesAddress">Loading...</span></p> 
        <p><b>Contact Number: </b><span id="dashboard-contact">Loading...</span></p>
    </div>
    
    <p>continue to Add your products in <b style="font-family: 'Righteous', serif; color:#009500; text-shadow: 0.8px 0 0 #000; font-style:italic;">nearby<span style="color:#A0D6B4;">s</span></b></p>
    <a href="https://nearbys.sp-seller.webkul.com/index.php?p=login" class="button" style="font-weight:bold; padding:5px 20px; border-radius:10px;">continue</a>

    <style>
        .payment-table {
            width: 100%;
            border-collapse: collapse;
            outline: 0.5px solid #2B547E; /* Outline instead of border */
        }
        .payment-table th, .payment-table td {
            border: 0.5px solid #2B547E;
            padding: 8px;
            text-align: left;
        }
        .payment-table th {
            text-align: center; /* Centering the headers */
            background-color: #f0f8ff;
        }
    </style>

    <div style="padding:20px; text-align:left; margin-bottom: 15px;">
        <h3 style="text-align:center; color:#2B547E;">Payment Details</h3>
        <table class="payment-table">
            <thead>
                <tr>
                    <th>Description</th>
                    <th>Details</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><b>Total Sales done:</b></td>
                    <td><span id="dashboard-totalSales">Loading...</span></td>
                </tr>
                <tr>
                    <td><b>Total payment received:</b></td>
                    <td><span id="dashboard-totalReceived">Loading...</span></td>
                </tr>
                <tr>
                    <td><b>Date of last payment:</b></td>
                    <td><span id="dashboard-lastPaymentDate">Loading...</span></td>
                </tr>
                <tr>
                    <td><b>Last Paid Amount:</b></td>
                    <td><span id="dashboard-lastPaidAmount">Loading...</span></td>
                </tr>
                <tr>
                    <td><b>Next payment Date:</b></td>
                    <td><span id="dashboard-nextPaymentDate">Loading...</span></td>
                </tr>
                <tr>
                    <td><b>Amount to be paid:</b></td>
                    <td><span id="dashboard-amountToBePaid">Loading...</span></td>
                </tr>
            </tbody>
        </table>    
    </div>
    <a href="https://order-app.sp-seller.webkul.com/index.php?p=login" class="button" style="font-weight:bold; padding:10px 110px; border-radius:10px;">Make Payment</a>
</div>
<!-- xxxxxxxxxxxxxxxxxx -->
<div id="successPopup" style="display: none;">
    <div id="popupBox">
        <p id="popupMessage"><span style="color:#009500; font-weight:bold;">Your details have been submitted successfully.</span><br><br>
            Please check your email for login information.</p>
        <button id="okButton" style="font-weight:bold">OK</button>
    </div>
</div> 
<!-- xxxxxxxxxxxxxxxxxxxxxxxx -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Righteous&amp;display=swap" rel="stylesheet"> 
<!-- xxxxxxxxxxxxxxxxxxxxxxxx -->
</div>
  <div class="contact">
    <div class="contact-inner">
       <a href="https://nearbys.online" target="_blank">
      <img src="https://cdn.shopify.com/s/files/1/0947/2340/8240/files/1000084881.webp?v=1743588303" alt="nearbys Logo" class="contact-logo">
    </a>

    <!-- Email Link with Icon -->
    <a href="mailto:admin@nearbys.online" class="contact-link">
      <i class="fas fa-envelope"></i> email
    </a>

    <!-- WhatsApp with Icon -->
    <a href="https://wa.me/971509880960" class="contact-link">
      <i class="fab fa-whatsapp"></i> whatsApp
    </a>     
    </div>
  </div>
</div>





<script>
        //open vendorForm
        
document.addEventListener("DOMContentLoaded", function () {
  const addShopButton = document.getElementById("addShopBtn");
  const loginContainer = document.getElementById("loginContainer");
  const vendorForm = document.getElementById("vendorForm");

  addShopButton.addEventListener("click", function () {
    // Hide the login container
    loginContainer.style.display = "none";
    // Show the contact form
    vendorForm.style.display = "block";
  });
});

//------------- t&c --------------------

  document.addEventListener('DOMContentLoaded', () => {
  const termsCheckbox = document.getElementById('termsCheckbox');
  const viewTerms = document.getElementById('viewTerms');
  const termsModal = document.getElementById('termsModal');
  const overlay = document.getElementById('termsOverlay');
  const acceptBtn = document.getElementById('termsAcceptBtn');
  const rejectBtn = document.getElementById('termsRejectBtn');
  const termsError = document.getElementById('termsError');

  // Prevent manual interaction with the checkbox
  termsCheckbox.addEventListener('click', (e) => {
    e.preventDefault();
    e.stopPropagation();
  });

  function openTermsModal() {
    overlay.style.display = 'block';
    termsModal.style.display = 'flex';
  }

  function closeTermsModal() {
    overlay.style.display = 'none';
    termsModal.style.display = 'none';
  }

  if (viewTerms) {
    viewTerms.addEventListener('click', (e) => {
      e.preventDefault();
      e.stopPropagation();
      openTermsModal();
    });
  }

  if (acceptBtn) {
    acceptBtn.addEventListener('click', (e) => {
      e.preventDefault();
      e.stopPropagation();
      termsCheckbox.checked = true;
      if (termsError) termsError.innerText = ''; // Clear error
      closeTermsModal();
    });
  }

  if (rejectBtn) {
    rejectBtn.addEventListener('click', (e) => {
      e.preventDefault();
      e.stopPropagation();
      termsCheckbox.checked = false;
      if (termsError) termsError.innerText = ''; // Clear error
      closeTermsModal();
    });
  }
});

//---------------------------------------

document.getElementById("validate").addEventListener("click", function () {
    function generateRandomCode() {
        const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
        const numbers = "0123456789";
        let randomLetters = "";
        let randomNumbers = "";

        for (let i = 0; i < 3; i++) {
            randomLetters += letters.charAt(Math.floor(Math.random() * letters.length));
            randomNumbers += numbers.charAt(Math.floor(Math.random() * numbers.length));
        }

        return randomLetters + randomNumbers;
    }

    document.getElementById("vendorCode").value = generateRandomCode();
});

//---------------------------------------
document.addEventListener("DOMContentLoaded", function () {
    const userIdInput = document.getElementById("userId");
    const vendorsCodeInput = document.getElementById("vendorsCode");
    const loginBtn = document.getElementById("loginBtn");
    const userIdError = document.getElementById("userIdError");
    const vendorsCodeError = document.getElementById("vendorsCodeError");
    const vendorDashboard = document.getElementById("vendorDashboard");

    // Check if user is already logged in
    const savedUser = JSON.parse(localStorage.getItem("loggedInVendor"));
    if (savedUser) {
        showDashboard();
        return;
    }

    loginBtn.addEventListener("click", function () {
        const enteredEmail = userIdInput.value.trim();
        const enteredVendorCode = vendorsCodeInput.value.trim();

        if (!enteredEmail || !enteredVendorCode) {
            userIdError.textContent = enteredEmail ? "" : "User ID is required.";
            vendorsCodeError.textContent = enteredVendorCode ? "" : "Vendor Code is required.";
            return;
        }

        // Fetch the JSON data
        fetch("https://dust-fantasy-pail.glitch.me/data")
            .then(response => response.json())
            .then(data => {
                // Check if any vendor matches the input credentials
                const matchedVendor = data.find(vendor => 
                    vendor.email === enteredEmail && vendor.vendorCode === enteredVendorCode
                );

                if (matchedVendor) {
                    // Save user details in localStorage
                    localStorage.setItem("loggedInVendor", JSON.stringify(matchedVendor));
                    showDashboard();
                } else {
                    userIdError.textContent = "Invalid credentials. Please try again.";
                    vendorsCodeError.textContent = "";
                }
            })
            .catch(error => {
                console.error("Error fetching vendor data:", error);
                userIdError.textContent = "Error fetching data. Try again later.";
            });
    });

    function showDashboard() {
        // Hide inputs and button
        userIdInput.style.display = "none";
        vendorsCodeInput.style.display = "none";
        loginBtn.style.display = "none";
        addShopBtn.style.display = "none";
        userIdError.textContent = "";
        vendorsCodeError.textContent = "";        document.querySelector("p").style.display = "none";
document.querySelector("h1").style.display = "none";        

        // Show the vendor dashboard
        vendorDashboard.style.display = "block";
    }
});
    
//---------------------------------------    

document.addEventListener("DOMContentLoaded", function () {
    let jsonData = [];

    // Fetch data on page load
    fetch("https://dust-fantasy-pail.glitch.me/data")
        .then(response => response.json())
        .then(data => {
            if (!Array.isArray(data)) {
                console.error("Fetched data is not an array.");
                return;
            }
            jsonData = data; // Store the fetched data

            // Check localStorage for saved values
            const savedUserId = localStorage.getItem("userId");
            const savedVendorCode = localStorage.getItem("vendorCode");

            if (savedUserId && savedVendorCode) {
                // Automatically populate and show details if a valid match is found
                const matchedRow = jsonData.find(row => row.email === savedUserId && row.vendorCode === savedVendorCode);
                if (matchedRow) {
                    updateDetails(matchedRow);
                }
            }
        })
        .catch(error => console.error("Error fetching data:", error));

    // Handle login button click
    document.getElementById("loginBtn").addEventListener("click", function () {
        const userId = document.getElementById("userId").value.trim();
        const vendorCode = document.getElementById("vendorsCode").value.trim();

        const userIdError = document.getElementById("userIdError");
        const vendorCodeError = document.getElementById("vendorsCodeError");

        // Clear previous error messages
        userIdError.textContent = "";
        vendorCodeError.textContent = "";

        // Validate inputs
        if (!userId) {
            userIdError.textContent = "Please enter a User ID.";
            return;
        }
        if (!vendorCode) {
            vendorCodeError.textContent = "Please enter a Vendor Code.";
            return;
        }

        // Save values to localStorage for persistence across page refresh
        localStorage.setItem("userId", userId);
        localStorage.setItem("vendorCode", vendorCode);

        // Find the matching row
        const matchedRow = jsonData.find(row => row.email === userId && row.vendorCode === vendorCode);

        if (matchedRow) {
            // Replace text content with the matched data
            updateDetails(matchedRow);
            showDashboard(); // Show the dashboard after updating details
        } else {
            userIdError.textContent = "Invalid User ID or Vendor Code.";
        }
    });
  
    function updateDetails(matchedRow) {
        document.getElementById("dashboard-firstName").textContent = matchedRow.firstName || "N/A";
        document.getElementById("dashboard-storeName").textContent = matchedRow.storeName || "N/A";
        document.getElementById("dashboard-storesAddress").textContent = matchedRow.storesAddress || "N/A";
        document.getElementById("dashboard-contact").textContent = matchedRow.contact || "N/A";

        // Payment Details (ensure correct IDs)
        document.getElementById("dashboard-totalSales").textContent = matchedRow.totalSales || "N/A";
        document.getElementById("dashboard-totalPayment").textContent = matchedRow.totalPayment || "N/A";
        document.getElementById("dashboard-lastPaymentDate").textContent = matchedRow.lastPaymentDate || "N/A"; // Fixed ID
        document.getElementById("dashboard-lastPaidAmount").textContent = matchedRow.lastPaidAmount || "N/A";
        document.getElementById("dashboard-nextPaymentDate").textContent = matchedRow.nextPaymentDate || "N/A";
        document.getElementById("dashboard-amountToBePaid").textContent = matchedRow.amountToBePaid || "N/A";
    }

    function showDashboard() {
        // Hide inputs and button
        document.getElementById("userId").style.display = "none";
        document.getElementById("vendorsCode").style.display = "none";
        document.getElementById("loginBtn").style.display = "none";
        document.getElementById("addShopBtn").style.display = "none";
        document.getElementById("userIdError").textContent = "";
        document.getElementById("vendorsCodeError").textContent = "";
        document.querySelector("p").style.display = "none";
        document.querySelector("h1").style.display = "none";        

        // Show the vendor dashboard
        document.getElementById("vendorDashboard").style.display = "block";
    }
});
//---------------------------------------
document.addEventListener("DOMContentLoaded", function () {
    const logoutBtn = document.getElementById("logoutBtn");

    logoutBtn.addEventListener("click", function () {
        // Clear the logged-in vendor data from localStorage
        localStorage.removeItem("loggedInVendor");

        // Hide the vendor dashboard
        document.getElementById("vendorDashboard").style.display = "none";

        // Show the login container
        document.getElementById("loginContainer").style.display = "block";

        // Clear the input fields
        document.getElementById("userId").value = "";
        document.getElementById("vendorsCode").value = "";

        // Refresh the page
        location.reload();
    });
});
//---------------------------------------
function showSuccessPopup() {
    const popup = document.getElementById("successPopup");
    popup.style.display = "flex"; // Show the popup

    document.getElementById("okButton").addEventListener("click", function () {
        popup.style.display = "none"; // Hide popup
        document.getElementById("vendorForm").style.display = "none"; // Hide form
        document.getElementById("loginContainer").style.display = "block"; // Show login container
    });
}
//---------------------------------------
</script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const socket = io("https://dust-fantasy-pail.glitch.me");

    let refCodeValidated = false;
    let locationReceived = false;

    // Validate RefCode
    document.getElementById("validate").addEventListener("click", function () {
        const refCode = document.getElementById("refCode").value.trim();
        const refCodeError = document.getElementById("refCodeError");
        const reffCodeMsg = document.getElementById("reffCodeMsg");

        if (!refCode) {
            refCodeError.innerText = "Referrer Code is required.";
            reffCodeMsg.innerText = "";
            refCodeValidated = false;
            return;
        }

        refCodeError.innerText = ""; // Clear previous error

        fetch("https://dust-fantasy-pail.glitch.me/data")
            .then(response => response.json())
            .then(data => {
                const isValid = data.some(user => user.refCode === refCode);
                if (isValid) {
                    reffCodeMsg.innerText = "Validated";
                    reffCodeMsg.style.color = "green";
                    refCodeValidated = true;
                } else {
                    reffCodeMsg.innerText = "REFF Code not matched";
                    reffCodeMsg.style.color = "red";
                    refCodeValidated = false;
                }
            })
            .catch(error => {
                console.error("Error fetching refCode data:", error);
                reffCodeMsg.innerText = "Error checking REFF Code.";
                reffCodeMsg.style.color = "red";
                refCodeValidated = false;
            });
    });

    // Get Location
    document.getElementById("getLocationButton").addEventListener("click", function () {
        const storeName = document.getElementById("storeName").value.trim();
        const storeCategory = document.getElementById("storeCategory").value.trim();
        const locationError = document.getElementById("locationError");

        if (!storeName) {
            locationError.innerText = "Store Name is required.";
            return;
        }
        if (!storeCategory) {
            locationError.innerText = "Store Category is required.";
            return;
        }

        locationError.innerText = ""; // Clear previous errors

        if ("geolocation" in navigator) {
            navigator.geolocation.getCurrentPosition(
                function (position) {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    const locationData = `"${storeName}": { lat: ${lat}, lng: ${lng}, categories: ["${storeCategory}"] }`;
                    document.getElementById("location").value = locationData;
                    locationError.innerText = "Location received";
                    locationError.style.color = "green";
                    locationReceived = true;
                },
                function () {
                    locationError.innerText = "Failed to get location. Please enable GPS.";
                    locationError.style.color = "red";
                    locationReceived = false;
                }
            );
        } else {
            locationError.innerText = "Geolocation is not supported in this browser.";
            locationError.style.color = "red";
            locationReceived = false;
        }
    });

    // Validate Email
    function validateEmail() {
        const email = document.getElementById("email").value.trim();
        const emailError = document.getElementById("emailError");
        const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

        if (!email) {
            emailError.innerText = "Email is required.";
            return false;
        } else if (!regex.test(email)) {
            emailError.innerText = "Invalid email format.";
            return false;
        } else {
            emailError.innerText = "";
            return true;
        }
    }

    // Validate Contact
    function validateContact() {
        const contact = document.getElementById("contact").value.trim();
        const contactError = document.getElementById("contactError");

        if (!contact) {
            contactError.innerText = "Contact Number is required.";
            return false;
        } else if (contact.length < 8 || contact.length > 15) {
            contactError.innerText = "Invalid contact number.";
            return false;
        } else {
            contactError.innerText = "";
            return true;
        }
    }

    // Validate Input Fields
    function validateInput(id, errorId, message) {
        const input = document.getElementById(id).value.trim();
        const errorElement = document.getElementById(errorId);

        if (!input) {
            errorElement.innerText = message;
            return false;
        } else {
            errorElement.innerText = "";
            return true;
        }
    }

//-----------------------------

    // Submit Form
async function submitUser() {
    const isValid = [
        validateInput("firstName", "firstNameError", "First Name is required."),
        validateInput("lastName", "lastNameError", "Last Name is required."),
        validateInput("storeName", "storeNameError", "Store Name is required."),
        validateInput("storeCategory", "storeCategoryError", "Store Category is required."),
        validateInput("storesAddress ", "storesAddress Error", "Store Address is required."),
        validateEmail(),
        validateContact(),
        validateInput("vendorCode", "vendorCodeError", "REFF Code must be validated.")
    ];

    const message = document.getElementById("message");

    if (!refCodeValidated) {
        document.getElementById("refCodeError").innerText = "Referrer Code must be validated.";
        return;
    }

    if (!locationReceived) {
        document.getElementById("locationError").innerText = "Location must be received.";
        return;
    }
    
    if (!document.getElementById("termsCheckbox").checked) {
    document.getElementById("termsError").innerText = "You must agree to the Terms & Conditions.";
    return;
}

    const refCode = document.getElementById("refCode").value.trim();
    let affiliateEmail = "";

    // Disable the submit button and change its text
    const submitButton = document.querySelector("button[onclick='submitUser()']");
    submitButton.disabled = true;
    submitButton.innerText = "Submitting...";

    // Add a countdown timer below the submit button
    let countdownContainer = document.getElementById("countdownContainer");
    if (!countdownContainer) {
        countdownContainer = document.createElement("div");
        countdownContainer.id = "countdownContainer";
        countdownContainer.style.marginTop = "10px";
        countdownContainer.style.fontSize = "14px";
        countdownContainer.style.color = "#555";
        submitButton.parentNode.insertBefore(countdownContainer, submitButton.nextSibling);
    }

    let countdownTime = 30; // 30 seconds
    countdownContainer.innerHTML = `Please wait... <span id="countdownTimer" style="font-weight:bold; color:red; font-size:20px;">${countdownTime}</span> seconds remaining.`;

    const countdownInterval = setInterval(() => {
        countdownTime--;
        document.getElementById("countdownTimer").innerText = countdownTime;

        if (countdownTime <= 0) {
            clearInterval(countdownInterval);
            countdownContainer.innerHTML = "<span style='color: red;'>Submission taking longer than expected. Please wait...</span>";
        }
    }, 1000);

    try {
        // Fetch JSON data for refCode validation
        const response = await fetch('https://dust-fantasy-pail.glitch.me/data');
        const jsonData = await response.json();

        // Find affiliateEmail by matching refCode
        const matchedData = jsonData.find(entry => entry.refCode === refCode);
        if (matchedData) {
            affiliateEmail = matchedData.affiliateEmail || "";
        }

        // Prepare user data for both socket and backend submission
        const userData = {
            firstName: document.getElementById("firstName").value.trim(),
            lastName: document.getElementById("lastName").value.trim(),
            refCode: refCode,
            storeName: document.getElementById("storeName").value.trim(),
            storeCategory: document.getElementById("storeCategory").value.trim(),
            storesAddress : document.getElementById("storesAddress ").value.trim(),
            location: document.getElementById("location").value.trim(),
            email: document.getElementById("email").value.trim(),
            contact: document.getElementById("contact").value.trim(),
            vendorCode: document.getElementById("vendorCode").value.trim(),
            affiliateEmail: affiliateEmail
        };

        // Send data to socket
        socket.emit("submitUser", userData);

        // Send data to backend
        const sendResponse = await fetch('https://bronzed-carpal-zone.glitch.me/send-email', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(userData)
        });

        // Reset form and display message
        document.getElementById("vendorForm").reset();
        refCodeValidated = false;
        locationReceived = false;
        document.getElementById("reffCodeMsg").innerText = "";
        document.getElementById("locationError").innerText = "";

        if (sendResponse.ok) {
            message.innerHTML = "<span style='color: green;'>User details submitted successfully!</span>";
            showSuccessPopup();
            clearInterval(countdownInterval); // Stop the timer on success
            countdownContainer.innerHTML = ""; // Clear the timer message
        } else {
            message.innerHTML = "<span style='color: red;'>Submission failed. Please try again.</span>";
            clearInterval(countdownInterval); // Stop the timer on failure
            countdownContainer.innerHTML = ""; // Clear the timer message
        }
    } catch (error) {
        message.innerHTML = "<span style='color: red;'>An error occurred. Please try again.</span>";
    } finally {
        // Re-enable the submit button and reset its text
        submitButton.disabled = false;
        submitButton.innerText = "Submit";
        }
        }
    

// Attach event listener to the submit button
document.querySelector("button[onclick='submitUser()']").addEventListener("click", submitUser);
});  
</script>

<script>
  let deferredPrompt;
  const installBtn = document.getElementById('installBtn');
  installBtn.style.display = 'block';

  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
  });

  installBtn.addEventListener('click', () => {
    if (deferredPrompt) {
      deferredPrompt.prompt();
      deferredPrompt.userChoice.then(choice => {
        if (choice.outcome === 'accepted') {
          console.log('✅ App installed');
        }
        deferredPrompt = null;
      });
    } else {
      alert("To install, open and tap browser menu > 'Install App'");
    }
  });
</script>
<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js')
      .then(() => console.log('✅ Service Worker Registered'))
      .catch(err => console.error('❌ SW registration failed:', err));
  }
</script>
<footer class="footer">
    <div style="padding: 10px; font-family: 'Righteous', cursive; font-style:italic;">
  <b>nearby<span style="color:#A0D6B4;">s</span></b> ⓒ 2025 <br>
  All rights reserved</div>
</footer>  

</body>
